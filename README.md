# SyntheticMedData

## Environment

- python3.x
- Anaconda (Recommended)

## building rotMNIST dataset

```
python build_rotMNIST.py
```

## Output

```
rotMNIST
  |
  |- data/*.npy : numpy data (Tx784(=28x28))（データファイル）
  |- rotMNIST.json: data and label ID list（データセットファイル）
  |- rotMNIST.label.json: description for each label ID（ラベルセットファイル）
  |- rotMNIST.png
```

### 医療データとの対応

データセットファイル（rotMNIST.json）は、時系列データを一人の患者もしくは一つの系列あたり以下の情報をもつ。
```
"rotMNIST/data/004784": {
        "data": [
            "rotMNIST/data/004783.data.npy"
        ],
        "mask": [
            "rotMNIST/data/004783.mask.npy"
        ],
        "interval": [
            "rotMNIST/data/004783.interval.npy"
        ],
        "input": [
            "rotMNIST/data/004783.input.npy"
        ],
        "state": [
            "rotMNIST/data/004783.state.npy"
        ],
        "label": 6
}
```
上に示した例では"rotMNIST/data/004784"が患者ID、そのバリューがその患者に関するデータとなっている。
ある患者は複数のデータを持っており、
キーがデータの種類の名前、バリューがデータファイルのパスとなっています。
（各バリューがリスト形式になっているが、複数ある場合は結合して用いる。特殊な用途のためにリストにしているので基本的には一つのみと考えて問題ない。）

#### *"data"*
- 計測値・検査値・観測値などの値
- データファイルはnumpyで ステップ x 計測値の数の行列となっている。

#### *"mask"*
- "data"で指定されたファイルの計測値・検査値・観測値の値が欠損しているかどうか
- データファイルはnumpyで ステップ x 計測値の数の行列となっている。

#### *"interval"*
- 各ステップ間の時間の間隔を表す（単位はデータによる）
- データファイルはnumpyでステップ数のベクトルとなっている。
- この値を積算していくと開始時からのあるステップの時刻が算出できる。

#### *"input"*
- 介入や投薬などの記録値
- データファイルはnumpyで ステップ x 記録値の数の行列となっている。

#### *"state"*
- 検査値から計算される指標やその他医師などが記録した病状や状態を表す指標
- データファイルはnumpyで ステップ x 指標数の行列となっている。
- データとしては利用できないことが多い

#### *"label"*
- 病気の種類や発症の有無などの患者の予後などの系列に付随したラベル
- 整数値のIDをここで指定し、各IDの意味についてはラベルセットファイル（rotMNIST.label.json）に記述されている。

## rotMNIST

rotMNISTは手書き文字データのMNISTをある角速度で回転させることで、
Tステップx784(=28x28)のデータを生成します。
これを検査データとみなすことにより、784個の検査項目が互いに関係を持ちつつ変化していくような状況となっています。
また、ランダムに観測ノイズを入れて、さらに、ランダムに欠損を入れるようにしています。
この欠損データは *"data"* のファイルだけでなく、*"mask"* のファイルにも適切に保存されます。
また、*inteval* はpoisson分布に従ってランダムに決定されます。
*"input"* は介入のデータとして、角速度に変化を与える要因としてランダムに与えており、加える角速度を保存しています。
*"state"* 状態として、現在の回転角度を入れています。（実際にはこの情報があると元のMNISTのデータに戻せますので、このデータは未知として扱うことが多い）

ラベルファイル（rotMNIST.label.json）には回転する数字(0-9)と回転する方向(L/R)を病気の種類とみなして、
以下のようにラベルをつけています。

```
{
    "0": "0L",
    "10": "0R",
    "1": "1L",
    "11": "1R",
    "2": "2L",
    "12": "2R",
    "3": "3L",
    "13": "3R",
    "4": "4L",
    "14": "4R",
    ....
}
```

現状ではすべての手書き数字を使っていますが、例えば6と9などは回転するとほぼ同じになるので、
識別問題等に取り組む場合には注意が必要である。


